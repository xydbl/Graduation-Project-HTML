{"remainingRequest":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\babel-loader\\lib\\index.js!D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\src\\page\\Blog.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\src\\page\\Blog.vue","mtime":1660893724849},{"path":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660272402559},{"path":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\babel-loader\\lib\\index.js","mtime":1660272402348},{"path":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660272402559},{"path":"D:\\HBuilderProjects\\vue2\\Graduation-Project-HTML\\node_modules\\vue-loader\\lib\\index.js","mtime":1660272406551}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.for-each\";\nimport _objectSpread from \"D:\\\\HBuilderProjects\\\\vue2\\\\Graduation-Project-HTML\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapMutations, mapState } from 'vuex';\nimport { marked } from 'marked';\nexport default {\n  name: 'Blog',\n  data: function data() {\n    return {\n      // 发表评论\n      commentary: '',\n      username: '',\n      // repMsg:'',\n      isReply: false,\n      // 回复信息\n      hMessage: '',\n      // 回复的评论id cid\n      cid: '',\n      // 评论列表\n      list: [],\n      // 评论数\n      commNum: ''\n    };\n  },\n  props: [\"bid\", \"btype\", 'btitle', 'bcontent', 'btime'],\n  methods: _objectSpread({}, mapMutations(\"userOptions\", {\n    getBlogUserMessage: 'GETBLOGUSERMESSAGE'\n  }), mapMutations(\"blogOptions\", {\n    currentBlog: 'CURRENTBLOG'\n  }), {\n    // 获取评论\n    // ...mapMutations('commentaryOptions',{currentCommentary:'CURRENTCOMMENTARY',commentaryBlog:'COMMENTARYBLOG'}),\n    // 获取评论 包含点赞等信息\n    getComm: function getComm() {\n      var _this = this;\n\n      var username = localStorage.getItem(\"username\"); // console.log(username,this.blog.bid,this.bid);\n\n      this.$axios.post('http://localhost:8081/api/commentary/findByBid', {\n        bid: this.bid || this.blog.bid,\n        s: this.user.userName || username\n      }).then(function (res) {\n        // console.log(res.data);\n        _this.list = res.data;\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    // 发送评论\n    sendComm: function sendComm() {\n      var _this2 = this;\n\n      if (this.commentary != '') {\n        this.$axios.post('http://localhost:8081/api/commentary/add', {\n          message: this.commentary,\n          messageId: this.user.uid,\n          ctime: new Date(),\n          ctype: 0,\n          clogId: this.blog.bid || this.bid\n        }).then(function (res) {\n          _this2.commentary = '';\n\n          _this2.getComm(); // this.currentCommentary(this.blog.bid ||this.bid)\n\n        }, function (error) {\n          console.log(error.message);\n        });\n      } else {\n        alert('不能为空');\n      }\n    },\n    // // 过滤评论\n    // approvedComment(){\n    //   this.list=this.commentaryList\n    //   this.list=this.list.filter((li)=>{\n    //     return li.ctype==1\n    //   })\n    // }\n    // 点赞功能\n    addD: function addD(cid) {\n      var _this3 = this;\n\n      // if(this.user.isTouristsLogin){\n      //   this.$message.warning('')\n      //   return false\n      // }\n      this.$axios.post('http://localhost:8081/api/dTable/add', {\n        dcid: cid,\n        duser: this.user.userName || '游客'\n      }).then(function (res) {\n        _this3.getComm();\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    // 过滤点赞信息\n    //  取消点赞\n    delD: function delD(did) {\n      var _this4 = this;\n\n      this.$axios.get(\"http://localhost:8081/api/dTable/del/\".concat(did)).then(function (res) {\n        _this4.getComm();\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    // 回复\n    startReply: function startReply(cid) {\n      this.isReply = true;\n      this.cid = cid;\n      this.$nextTick(function () {\n        this.$refs.reply.focus();\n      });\n    },\n    // 取消回复\n    endReply: function endReply() {\n      this.hMessage = '';\n      this.isReply = false;\n    },\n    // 回复\n    replyMsg: function replyMsg() {\n      var _this5 = this;\n\n      this.$axios.post('http://localhost:8081/api/reply/add', {\n        hcid: this.cid,\n        hmessage: this.hMessage,\n        htime: new Date(),\n        state: 0,\n        husr: this.user.userName || '游客',\n        hbid: this.blog.bid || this.bid\n      }).then(function (res) {\n        _this5.isReply = false;\n        _this5.hMessage = '';\n\n        _this5.getComm();\n\n        _this5.msg1();\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    // 提示信息\n    msg1: function msg1() {\n      this.$message({\n        message: '成功',\n        type: 'success'\n      });\n    },\n    msg2: function msg2() {\n      this.$message.error(\"失败\");\n    },\n    // 测试\n    test2: function test2() {\n      var username = localStorage.getItem(\"username\");\n      this.$axios.post('http://localhost:8081/api/commentary/commPage', {\n        bid: this.blog.bid || this.bid,\n        pageIndex: 1,\n        pageSize: 6,\n        s: username || this.user.userName\n      }).then(function (res) {\n        console.log(res.data);\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    // 隐藏 显示\n    lookReply: function lookReply(comm) {\n      if (!comm.isLook) {\n        if (comm.isLook == null || comm.isLook == undefined) {\n          this.$set(comm, 'isLook', true);\n        } else {\n          comm.isLook = true;\n        }\n      } else {\n        comm.isLook = false;\n      }\n    },\n    // 评论数量 评论+回复\n    getCommNum: function getCommNum() {\n      var num = 0;\n      this.list.forEach(function (li) {\n        num++;\n\n        if (li.replyList.length != 0) {\n          var x = li.replyList;\n          x.forEach(function (x) {\n            num++;\n          });\n        }\n      });\n      this.$nextTick(function () {\n        this.commNum = num;\n      });\n    },\n    // 收藏博客\n    collectBlog: function collectBlog() {\n      var _this6 = this;\n\n      if (this.user.isTouristsLogin) {\n        this.$message.warning(\"注册后才可所有此功能\");\n        return false;\n      }\n\n      this.$axios.post('http://localhost:8081/api/collect/add', {\n        uid: this.user.uid,\n        bid: this.blog.bid || this.bid,\n        time: new Date()\n      }).then(function (res) {\n        if (res.data) {\n          _this6.$message({\n            message: '收藏成功',\n            type: 'success'\n          });\n        } else {\n          _this6.$message({\n            message: '您已收藏本博客，请勿重复收藏',\n            type: 'warning'\n          });\n        }\n      }, function (error) {\n        console.log(error.message);\n      });\n    },\n    addBlogClick: function addBlogClick() {\n      this.$axios.get(\"http://localhost:8081/api/blog/addClick/\".concat(this.bid || this.blog.bid)).then(function (res) {// console.log(\"ok\");\n      }, function (error) {\n        console.log(error.message);\n      });\n    }\n  }),\n  computed: _objectSpread({}, mapState('userOptions', {\n    user: 'user',\n    blogUser: 'blogUser'\n  }), mapState('blogOptions', {\n    blog: 'blog'\n  }), {\n    // ...mapState('commentaryOptions',{commentaryList:'commentaryList'}),\n    compiledMarkdown: function compiledMarkdown() {\n      return marked.parse(this.bcontent || this.blog.bcontent || '', {\n        sanitize: true\n      });\n    }\n  }),\n  mounted: function mounted() {\n    var _this7 = this;\n\n    var bid = sessionStorage.getItem(\"getbid\");\n\n    if (bid == null || bid == '') {\n      // console.log(this.bid);\n      this.getBlogUserMessage(this.bid);\n      sessionStorage.setItem(\"getbid\", this.bid); // this.currentCommentary(this.bid)\n      // this.getComm()\n    } else {\n      var _bid = sessionStorage.getItem(\"getbid\");\n\n      this.getBlogUserMessage(_bid);\n      this.currentBlog(_bid); // this.currentCommentary(bid)\n      // this.getComm()\n    }\n\n    setTimeout(function () {\n      _this7.username = _this7.blogUser.username; // this.commentaryBlog()\n      // this.getComm()\n      // this.test2()\n    }, 200);\n    setTimeout(function () {\n      _this7.getComm();\n    }, 300);\n    setTimeout(function () {\n      _this7.getCommNum();\n    }, 500);\n    setTimeout(function () {\n      _this7.addBlogClick();\n    }, 6000);\n  }\n};",{"version":3,"sources":["Blog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwEA,SAAA,YAAA,EAAA,QAAA,QAAA,MAAA;AACA,SAAA,MAAA,QAAA,QAAA;AACA,eAAA;AACA,EAAA,IAAA,EAAA,MADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA;AACA,MAAA,UAAA,EAAA,EAFA;AAGA,MAAA,QAAA,EAAA,EAHA;AAIA;AACA,MAAA,OAAA,EAAA,KALA;AAMA;AACA,MAAA,QAAA,EAAA,EAPA;AAQA;AACA,MAAA,GAAA,EAAA,EATA;AAUA;AACA,MAAA,IAAA,EAAA,EAXA;AAYA;AACA,MAAA,OAAA,EAAA;AAbA,KAAA;AAeA,GAlBA;AAmBA,EAAA,KAAA,EAAA,CAAA,KAAA,EAAA,OAAA,EAAA,QAAA,EAAA,UAAA,EAAA,OAAA,CAnBA;AAoBA,EAAA,OAAA,oBAEA,YAAA,CAAA,aAAA,EAAA;AAAA,IAAA,kBAAA,EAAA;AAAA,GAAA,CAFA,EAGA,YAAA,CAAA,aAAA,EAAA;AAAA,IAAA,WAAA,EAAA;AAAA,GAAA,CAHA;AAIA;AACA;AAEA;AACA,IAAA,OARA,qBAQA;AAAA;;AACA,UAAA,QAAA,GAAA,YAAA,CAAA,OAAA,CAAA,UAAA,CAAA,CADA,CAEA;;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,gDAAA,EAAA;AACA,QAAA,GAAA,EAAA,KAAA,GAAA,IAAA,KAAA,IAAA,CAAA,GADA;AAEA,QAAA,CAAA,EAAA,KAAA,IAAA,CAAA,QAAA,IAAA;AAFA,OAAA,EAGA,IAHA,CAGA,UAAA,GAAA,EAAA;AACA;AACA,QAAA,KAAA,CAAA,IAAA,GAAA,GAAA,CAAA,IAAA;AACA,OANA,EAOA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OATA;AAUA,KArBA;AAsBA;AACA,IAAA,QAvBA,sBAuBA;AAAA;;AACA,UAAA,KAAA,UAAA,IAAA,EAAA,EAAA;AACA,aAAA,MAAA,CAAA,IAAA,CAAA,0CAAA,EAAA;AACA,UAAA,OAAA,EAAA,KAAA,UADA;AAEA,UAAA,SAAA,EAAA,KAAA,IAAA,CAAA,GAFA;AAGA,UAAA,KAAA,EAAA,IAAA,IAAA,EAHA;AAIA,UAAA,KAAA,EAAA,CAJA;AAKA,UAAA,MAAA,EAAA,KAAA,IAAA,CAAA,GAAA,IAAA,KAAA;AALA,SAAA,EAMA,IANA,CAMA,UAAA,GAAA,EAAA;AACA,UAAA,MAAA,CAAA,UAAA,GAAA,EAAA;;AACA,UAAA,MAAA,CAAA,OAAA,GAFA,CAGA;;AACA,SAVA,EAUA,UAAA,KAAA,EAAA;AACA,UAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,SAZA;AAaA,OAdA,MAcA;AACA,QAAA,KAAA,CAAA,MAAA,CAAA;AACA;AACA,KAzCA;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,IAAA,IAnDA,gBAmDA,GAnDA,EAmDA;AAAA;;AACA;AACA;AACA;AACA;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,sCAAA,EAAA;AACA,QAAA,IAAA,EAAA,GADA;AAEA,QAAA,KAAA,EAAA,KAAA,IAAA,CAAA,QAAA,IAAA;AAFA,OAAA,EAGA,IAHA,CAGA,UAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,OAAA;AACA,OALA,EAKA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OAPA;AAQA,KAhEA;AAiEA;AACA;AACA,IAAA,IAnEA,gBAmEA,GAnEA,EAmEA;AAAA;;AACA,WAAA,MAAA,CAAA,GAAA,gDAAA,GAAA,GACA,IADA,CACA,UAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,OAAA;AACA,OAHA,EAIA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OANA;AAOA,KA3EA;AA4EA;AACA,IAAA,UA7EA,sBA6EA,GA7EA,EA6EA;AACA,WAAA,OAAA,GAAA,IAAA;AACA,WAAA,GAAA,GAAA,GAAA;AACA,WAAA,SAAA,CAAA,YAAA;AACA,aAAA,KAAA,CAAA,KAAA,CAAA,KAAA;AACA,OAFA;AAGA,KAnFA;AAoFA;AACA,IAAA,QArFA,sBAqFA;AACA,WAAA,QAAA,GAAA,EAAA;AACA,WAAA,OAAA,GAAA,KAAA;AACA,KAxFA;AAyFA;AACA,IAAA,QA1FA,sBA0FA;AAAA;;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,qCAAA,EAAA;AACA,QAAA,IAAA,EAAA,KAAA,GADA;AAEA,QAAA,QAAA,EAAA,KAAA,QAFA;AAGA,QAAA,KAAA,EAAA,IAAA,IAAA,EAHA;AAIA,QAAA,KAAA,EAAA,CAJA;AAKA,QAAA,IAAA,EAAA,KAAA,IAAA,CAAA,QAAA,IAAA,IALA;AAMA,QAAA,IAAA,EAAA,KAAA,IAAA,CAAA,GAAA,IAAA,KAAA;AANA,OAAA,EAOA,IAPA,CAOA,UAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,OAAA,GAAA,KAAA;AACA,QAAA,MAAA,CAAA,QAAA,GAAA,EAAA;;AACA,QAAA,MAAA,CAAA,OAAA;;AACA,QAAA,MAAA,CAAA,IAAA;AACA,OAZA,EAaA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OAfA;AAgBA,KA3GA;AA4GA;AACA,IAAA,IA7GA,kBA6GA;AACA,WAAA,QAAA,CAAA;AACA,QAAA,OAAA,EAAA,IADA;AAEA,QAAA,IAAA,EAAA;AAFA,OAAA;AAIA,KAlHA;AAmHA,IAAA,IAnHA,kBAmHA;AACA,WAAA,QAAA,CAAA,KAAA,CAAA,IAAA;AACA,KArHA;AAsHA;AACA,IAAA,KAvHA,mBAuHA;AACA,UAAA,QAAA,GAAA,YAAA,CAAA,OAAA,CAAA,UAAA,CAAA;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,+CAAA,EAAA;AACA,QAAA,GAAA,EAAA,KAAA,IAAA,CAAA,GAAA,IAAA,KAAA,GADA;AAEA,QAAA,SAAA,EAAA,CAFA;AAGA,QAAA,QAAA,EAAA,CAHA;AAIA,QAAA,CAAA,EAAA,QAAA,IAAA,KAAA,IAAA,CAAA;AAJA,OAAA,EAKA,IALA,CAKA,UAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA,CAAA,IAAA;AACA,OAPA,EAOA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OATA;AAUA,KAnIA;AAoIA;AACA,IAAA,SArIA,qBAqIA,IArIA,EAqIA;AACA,UAAA,CAAA,IAAA,CAAA,MAAA,EAAA;AACA,YAAA,IAAA,CAAA,MAAA,IAAA,IAAA,IAAA,IAAA,CAAA,MAAA,IAAA,SAAA,EAAA;AACA,eAAA,IAAA,CAAA,IAAA,EAAA,QAAA,EAAA,IAAA;AACA,SAFA,MAEA;AACA,UAAA,IAAA,CAAA,MAAA,GAAA,IAAA;AACA;AACA,OANA,MAMA;AACA,QAAA,IAAA,CAAA,MAAA,GAAA,KAAA;AACA;AAEA,KAhJA;AAiJA;AACA,IAAA,UAlJA,wBAkJA;AACA,UAAA,GAAA,GAAA,CAAA;AACA,WAAA,IAAA,CAAA,OAAA,CAAA,UAAA,EAAA,EAAA;AACA,QAAA,GAAA;;AACA,YAAA,EAAA,CAAA,SAAA,CAAA,MAAA,IAAA,CAAA,EAAA;AACA,cAAA,CAAA,GAAA,EAAA,CAAA,SAAA;AACA,UAAA,CAAA,CAAA,OAAA,CAAA,UAAA,CAAA,EAAA;AACA,YAAA,GAAA;AACA,WAFA;AAGA;AACA,OARA;AASA,WAAA,SAAA,CAAA,YAAA;AACA,aAAA,OAAA,GAAA,GAAA;AACA,OAFA;AAGA,KAhKA;AAiKA;AACA,IAAA,WAlKA,yBAkKA;AAAA;;AACA,UAAA,KAAA,IAAA,CAAA,eAAA,EAAA;AACA,aAAA,QAAA,CAAA,OAAA,CAAA,YAAA;AACA,eAAA,KAAA;AACA;;AACA,WAAA,MAAA,CAAA,IAAA,CAAA,uCAAA,EAAA;AACA,QAAA,GAAA,EAAA,KAAA,IAAA,CAAA,GADA;AAEA,QAAA,GAAA,EAAA,KAAA,IAAA,CAAA,GAAA,IAAA,KAAA,GAFA;AAGA,QAAA,IAAA,EAAA,IAAA,IAAA;AAHA,OAAA,EAIA,IAJA,CAIA,UAAA,GAAA,EAAA;AACA,YAAA,GAAA,CAAA,IAAA,EAAA;AACA,UAAA,MAAA,CAAA,QAAA,CAAA;AACA,YAAA,OAAA,EAAA,MADA;AAEA,YAAA,IAAA,EAAA;AAFA,WAAA;AAIA,SALA,MAKA;AACA,UAAA,MAAA,CAAA,QAAA,CAAA;AACA,YAAA,OAAA,EAAA,gBADA;AAEA,YAAA,IAAA,EAAA;AAFA,WAAA;AAIA;AACA,OAhBA,EAgBA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OAlBA;AAmBA,KA1LA;AA2LA,IAAA,YA3LA,0BA2LA;AACA,WAAA,MAAA,CAAA,GAAA,mDAAA,KAAA,GAAA,IAAA,KAAA,IAAA,CAAA,GAAA,GACA,IADA,CACA,UAAA,GAAA,EAAA,CACA;AACA,OAHA,EAGA,UAAA,KAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,CAAA,OAAA;AACA,OALA;AAMA;AAlMA,IApBA;AAwNA,EAAA,QAAA,oBACA,QAAA,CAAA,aAAA,EAAA;AAAA,IAAA,IAAA,EAAA,MAAA;AAAA,IAAA,QAAA,EAAA;AAAA,GAAA,CADA,EAEA,QAAA,CAAA,aAAA,EAAA;AAAA,IAAA,IAAA,EAAA;AAAA,GAAA,CAFA;AAGA;AACA,IAAA,gBAJA,8BAIA;AACA,aAAA,MAAA,CAAA,KAAA,CAAA,KAAA,QAAA,IAAA,KAAA,IAAA,CAAA,QAAA,IAAA,EAAA,EAAA;AAAA,QAAA,QAAA,EAAA;AAAA,OAAA,CAAA;AACA;AANA,IAxNA;AA8OA,EAAA,OA9OA,qBA8OA;AAAA;;AACA,QAAA,GAAA,GAAA,cAAA,CAAA,OAAA,CAAA,QAAA,CAAA;;AACA,QAAA,GAAA,IAAA,IAAA,IAAA,GAAA,IAAA,EAAA,EAAA;AACA;AACA,WAAA,kBAAA,CAAA,KAAA,GAAA;AACA,MAAA,cAAA,CAAA,OAAA,CAAA,QAAA,EAAA,KAAA,GAAA,EAHA,CAIA;AACA;AACA,KANA,MAMA;AACA,UAAA,IAAA,GAAA,cAAA,CAAA,OAAA,CAAA,QAAA,CAAA;;AACA,WAAA,kBAAA,CAAA,IAAA;AACA,WAAA,WAAA,CAAA,IAAA,EAHA,CAIA;AACA;AACA;;AACA,IAAA,UAAA,CAAA,YAAA;AACA,MAAA,MAAA,CAAA,QAAA,GAAA,MAAA,CAAA,QAAA,CAAA,QAAA,CADA,CAEA;AACA;AACA;AAEA,KANA,EAMA,GANA,CAAA;AAOA,IAAA,UAAA,CAAA,YAAA;AACA,MAAA,MAAA,CAAA,OAAA;AACA,KAFA,EAEA,GAFA,CAAA;AAGA,IAAA,UAAA,CAAA,YAAA;AACA,MAAA,MAAA,CAAA,UAAA;AACA,KAFA,EAEA,GAFA,CAAA;AAGA,IAAA,UAAA,CAAA,YAAA;AACA,MAAA,MAAA,CAAA,YAAA;AACA,KAFA,EAEA,IAFA,CAAA;AAGA;AA7QA,CAAA","sourcesContent":["<template>\r\n  <div class=\"bbody\">\r\n    <div class=\"bmain\">\r\n      <div style=\"border-bottom: 1px solid red; width:630px\">\r\n        <!-- 标题 -->\r\n        <h1>{{btitle||blog.btitle}}</h1>\r\n        <span style=\"position: relative; left: 10px;bottom: 5px;\">\r\n          发布人：\r\n          <router-link replace :to=\"{\r\n            name:'showUsr',\r\n            params:{\r\n              uid:this.blogUser.uid,\r\n              username:username,\r\n              image:this.blogUser.image\r\n            }\r\n            }\">{{username}}</router-link>\r\n        </span>\r\n        <el-button type=\"warning\" icon=\"el-icon-star-off\" circle style=\"position:relative;left:450px;top:-40px\" @click=\"collectBlog\" size=\"mini\"></el-button>\r\n        <span style=\"position: relative; left: 230px;bottom: 5px;\">发布时间：2020-08-09 07:25:33</span>\r\n      </div>\r\n\t    <!-- 正文 -->\r\n      <div>\r\n        <div v-html=\"compiledMarkdown\"></div>\r\n\t    </div>\r\n      <!-- 评论 -->\r\n      <div style=\"position: relative;border-bottom: 1px solid #7E8388;top:20px\">\r\n        <el-badge :value=\"commNum\" :max=\"99\" class=\"item\" style=\"font-size: 20px;\">\r\n          评论\r\n        </el-badge>\r\n      </div>\r\n      <div class=\"botm\">\r\n        <div>\r\n\t\t\t    <input type=\"text\" placeholder=\"进行评论\" v-model=\"commentary\"><button @click=\"sendComm\">发表评论</button>\r\n\t\t    </div>\r\n        <div style=\"margin-left:20px;margin-top:10px;border-bottom:1px solid black\" v-for=\" comm in list\" :key=\"comm.cid\">\r\n          <div>\r\n            <h2>{{comm.messageId}}</h2>\r\n            <p>&nbsp&nbsp{{comm.message}}</p>\r\n            <div style=\"text-align:left;\">\r\n              <span style=\"margin-bottom:10px;\">{{comm.ctime}}</span>\r\n              <span >\r\n                <img v-if=\"comm.isD\" src=\"../assets/Active.png\" alt=\"\" @click=\"delD(comm.did)\" style=\"width:20px;height:20px;margin-left:10px;cursor: pointer;\">\r\n                <img v-if=\"!comm.isD\" src=\"../assets/White.png\" alt=\"\" @click=\"addD(comm.cid)\" style=\"width:20px;height:20px;margin-left:10px;cursor: pointer;\">\r\n              </span>\r\n              <span style=\"margin-left:6px\">{{comm.list.length}}</span>\r\n              <span class=\"reply\" @click=\"startReply(comm.cid)\">回复</span>\r\n              <span class=\"lookcomm\" v-if=\"comm.replyList.length!=0\" @click=\"lookReply(comm)\">查看/收起</span>\r\n              <div class=\"replybox1\" v-if=\"comm.isLook\" v-for=\"li in comm.replyList\">\r\n                <span style=\"font-size:18px;\">&nbsp&nbsp{{li.husr||'游客'}}</span><br>\r\n                <span>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp{{li.hmessage}}</span>\r\n              </div>\r\n            </div>\r\n            <div></div>\r\n          </div>\r\n          <!-- <ul>\r\n            <li v-for=\" comm in list\" :key=\"comm.cid\"><span>{{comm.messageId}}</span><br><br>{{comm.message}}<br><span style=\"font-size:10px\">评论时间:{{comm.ctime}}</span></li>\r\n          </ul> -->\r\n        </div>\r\n        <div class=\"reply1\" v-if=\"isReply\">\r\n          <input type=\"text\" placeholder=\"请输入要回复的内容\" v-model=\"hMessage\" ref=\"reply\"><button @click=\"endReply\">取消</button>\r\n          <button @click=\"replyMsg\">回复</button>\r\n        </div>\r\n        <!-- <div> -->\r\n          <!-- <el-button :plain=\"true\" @click=\"msg1\">xxxxx</el-button> -->\r\n        <!-- </div> -->\r\n      </div>\r\n      \r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapMutations, mapState } from 'vuex'\r\nimport {marked} from 'marked'\r\nexport default {\r\n    name:'Blog',\r\n    data() {\r\n      return {\r\n        // 发表评论\r\n        commentary:'',\r\n        username:'',\r\n        // repMsg:'',\r\n        isReply:false,\r\n        // 回复信息\r\n        hMessage:'',\r\n        // 回复的评论id cid\r\n        cid:'',\r\n        // 评论列表\r\n        list:[],\r\n        // 评论数\r\n        commNum:''\r\n      }\r\n    },\r\n    props:[\"bid\",\"btype\",'btitle','bcontent','btime'],\r\n    methods:{\r\n      // 获取博主信息\r\n      ...mapMutations(\"userOptions\",{getBlogUserMessage:'GETBLOGUSERMESSAGE'}),\r\n      ...mapMutations(\"blogOptions\",{currentBlog:'CURRENTBLOG'}),\r\n      // 获取评论\r\n      // ...mapMutations('commentaryOptions',{currentCommentary:'CURRENTCOMMENTARY',commentaryBlog:'COMMENTARYBLOG'}),\r\n\r\n      // 获取评论 包含点赞等信息\r\n      getComm(){\r\n        let username=localStorage.getItem(\"username\")\r\n        // console.log(username,this.blog.bid,this.bid);\r\n        this.$axios.post('http://localhost:8081/api/commentary/findByBid',{\r\n          bid:this.bid||this.blog.bid,\r\n          s:this.user.userName||username\r\n        }).then(res=>{\r\n          // console.log(res.data);\r\n          this.list=res.data\r\n        },\r\n        error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      // 发送评论\r\n      sendComm(){\r\n        if(this.commentary!=''){\r\n          this.$axios.post('http://localhost:8081/api/commentary/add',{\r\n            message:this.commentary,\r\n            messageId:this.user.uid,\r\n            ctime:new Date(),\r\n            ctype:0,\r\n            clogId:this.blog.bid||this.bid\r\n          }).then(res=>{\r\n            this.commentary=''\r\n            this.getComm()\r\n            // this.currentCommentary(this.blog.bid ||this.bid)\r\n          },error=>{\r\n            console.log(error.message);\r\n          })\r\n        }else{\r\n          alert('不能为空')\r\n        }\r\n      },\r\n      // // 过滤评论\r\n      // approvedComment(){\r\n      //   this.list=this.commentaryList\r\n      //   this.list=this.list.filter((li)=>{\r\n      //     return li.ctype==1\r\n      //   })\r\n      // }\r\n\r\n      // 点赞功能\r\n      addD(cid){\r\n        // if(this.user.isTouristsLogin){\r\n        //   this.$message.warning('')\r\n        //   return false\r\n        // }\r\n        this.$axios.post('http://localhost:8081/api/dTable/add',{\r\n          dcid:cid,\r\n          duser:this.user.userName||'游客'\r\n        }).then(res=>{\r\n          this.getComm()\r\n        },error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      // 过滤点赞信息\r\n      //  取消点赞\r\n      delD(did){\r\n        this.$axios.get(`http://localhost:8081/api/dTable/del/${did}`)\r\n        .then(res=>{\r\n          this.getComm()\r\n        },\r\n        error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      // 回复\r\n      startReply(cid){\r\n        this.isReply=true\r\n        this.cid=cid\r\n        this.$nextTick(function(){\r\n          this.$refs.reply.focus()\r\n        })\r\n      },\r\n      // 取消回复\r\n      endReply(){\r\n        this.hMessage=''\r\n        this.isReply=false\r\n      },\r\n      // 回复\r\n      replyMsg(){\r\n        this.$axios.post('http://localhost:8081/api/reply/add',{\r\n          hcid:this.cid,\r\n          hmessage:this.hMessage,\r\n          htime:new Date(),\r\n          state:0,\r\n          husr:this.user.userName||'游客',\r\n          hbid:this.blog.bid||this.bid\r\n        }).then(res=>{\r\n          this.isReply=false\r\n          this.hMessage=''\r\n          this.getComm()\r\n          this.msg1()\r\n        },\r\n        error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      // 提示信息\r\n      msg1(){\r\n        this.$message({\r\n          message:'成功',\r\n          type:'success'\r\n        })\r\n      },\r\n      msg2(){\r\n        this.$message.error(\"失败\")\r\n      },\r\n      // 测试\r\n      test2(){\r\n        let username=localStorage.getItem(\"username\")\r\n        this.$axios.post('http://localhost:8081/api/commentary/commPage',{\r\n          bid:this.blog.bid||this.bid,\r\n          pageIndex:1,\r\n          pageSize:6,\r\n          s:username||this.user.userName\r\n        }).then(res=>{\r\n          console.log(res.data);\r\n        },error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      // 隐藏 显示\r\n      lookReply(comm){\r\n        if(!comm.isLook){\r\n          if(comm.isLook==null||comm.isLook==undefined){\r\n            this.$set(comm,'isLook',true)\r\n          }else{\r\n            comm.isLook=true\r\n          }\r\n        }else{\r\n          comm.isLook=false\r\n        }\r\n        \r\n      },\r\n      // 评论数量 评论+回复\r\n      getCommNum(){\r\n        let num=0\r\n        this.list.forEach(li => {\r\n          num++\r\n          if (li.replyList.length!=0) {\r\n            let x=li.replyList\r\n            x.forEach(x=>{\r\n              num++\r\n            })\r\n          }\r\n        });\r\n        this.$nextTick(function(){\r\n          this.commNum=num\r\n        })\r\n      },\r\n      // 收藏博客\r\n      collectBlog(){\r\n        if(this.user.isTouristsLogin){\r\n          this.$message.warning(\"注册后才可所有此功能\")\r\n          return false\r\n        }\r\n        this.$axios.post('http://localhost:8081/api/collect/add',{\r\n          uid:this.user.uid,\r\n          bid:this.blog.bid||this.bid,\r\n          time:new Date()\r\n        }).then(res=>{\r\n          if (res.data) {\r\n            this.$message({\r\n              message:'收藏成功',\r\n              type:'success'\r\n            })\r\n          }else{\r\n            this.$message({\r\n              message:'您已收藏本博客，请勿重复收藏',\r\n              type:'warning'\r\n            })\r\n          }\r\n        },error=>{\r\n          console.log(error.message);\r\n        })\r\n      },\r\n      addBlogClick(){\r\n        this.$axios.get(`http://localhost:8081/api/blog/addClick/${this.bid||this.blog.bid}`)\r\n        .then(res=>{\r\n          // console.log(\"ok\");\r\n        },error=>{\r\n          console.log(error.message);\r\n        })\r\n      }\r\n    },\r\n    computed:{\r\n      ...mapState('userOptions',{user:'user',blogUser:'blogUser'}),\r\n      ...mapState('blogOptions',{blog:'blog'}),\r\n      // ...mapState('commentaryOptions',{commentaryList:'commentaryList'}),\r\n      compiledMarkdown(){\r\n        return marked.parse(this.bcontent||this.blog.bcontent||'',{sanitize:true})\r\n      },\r\n      // 评论数量\r\n      // getCommNum(){\r\n      //   let num=0\r\n      //   this.list.forEach(li => {\r\n      //     num++\r\n      //     if (li.replyList.length!=0) {\r\n      //       let x=li.replyList\r\n      //       x.forEach(x=>{\r\n      //         num++\r\n      //       })\r\n      //     }\r\n      //   });\r\n      //   return num\r\n      // }\r\n    },\r\n    mounted(){\r\n        let bid=sessionStorage.getItem(\"getbid\")\r\n        if (bid==null||bid=='') {\r\n          // console.log(this.bid);\r\n          this.getBlogUserMessage(this.bid)\r\n          sessionStorage.setItem(\"getbid\",this.bid)\r\n          // this.currentCommentary(this.bid)\r\n          // this.getComm()\r\n        }else{\r\n          let bid=sessionStorage.getItem(\"getbid\")\r\n          this.getBlogUserMessage(bid)\r\n          this.currentBlog(bid)\r\n          // this.currentCommentary(bid)\r\n          // this.getComm()\r\n        }\r\n        setTimeout(() => {\r\n          this.username=this.blogUser.username \r\n          // this.commentaryBlog()\r\n          // this.getComm()\r\n          // this.test2()\r\n          \r\n        }, 200);\r\n        setTimeout(() => {\r\n          this.getComm()\r\n        }, 300);\r\n        setTimeout(() => {\r\n          this.getCommNum()\r\n        }, 500);\r\n        setTimeout(() => {\r\n          this.addBlogClick()\r\n        }, 6000);\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.bbody{\r\n  position: absolute;\r\n  left: 400px;\r\n  width: 650px;\r\n  height: 700px;\r\n}\r\n.bmain{\r\n  position: absolute;\r\n  left: 20px;\r\n}\r\n.item {\r\n  margin-top: 10px;\r\n  margin-right: 40px;\r\n}\r\n.botm{\r\n  position: relative;\r\n  top: 25px;\r\n  font-size: 18px;\r\n}\r\n.botm input{\r\n\theight: 30px;\r\n\twidth: 550px;\r\n}\r\n.botm button{\r\n\theight: 35px;\r\n}\r\n.botm ul li{\r\n  list-style-type: decimal;\r\n}\r\n.botm span{\r\n  font-size: 14px;\r\n}\r\n.reply{\r\n  margin-left:10px;\r\n  cursor: pointer;\r\n}\r\n.reply:hover{\r\n  color: skyblue;\r\n}\r\n.reply1{\r\n  position: fixed;\r\n  top: 500px;\r\n  left: 500px;\r\n  opacity: 0.9;\r\n}\r\n.reply1 button{\r\n  width: 60px;\r\n  border: 0;\r\n  opacity: 0.7;\r\n  cursor: pointer;\r\n  margin-left: 10px;\r\n}\r\n.replybox1{\r\n  border-top: 1px solid burlywood;\r\n  opacity: 0.6;\r\n  background-color: antiquewhite;\r\n}\r\n.lookcomm{\r\n  cursor: pointer;\r\n  margin-left:20px\r\n}\r\n.lookcomm:hover{\r\n  color: skyblue;\r\n}\r\n</style>"],"sourceRoot":"src/page"}]}